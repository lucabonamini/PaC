#include "cubic_spline_planner/cubic_spline_planner.h"
#include "matplotlibcpp.h"
#include "speed_profile/speed_profile.h"
#include "utilities/types.h"

namespace plt = matplotlibcpp;

int main() {

  // std::vector<double> wx{-2.5, 0.0, 2.5, 5.0, 7.5, 3.0, -1.0};
  // std::vector<double> wy{0.7, -6.0, 2.0, -4.0, 0.0, 5.0, -2.0};

  std::vector<double> wx {
    5.74071,
6.24038,
6.5391,
7.05757,
7.5298,
7.98829,
8.40641,
8.77135,
9.06782,
9.29914,
9.43836,
9.54471,
9.60177,
9.62637,
9.63207,
9.64677,
9.65098,
9.66357,
9.68707,
9.71035,
9.72638,
9.74565,
9.77463,
9.79671,
9.813,
9.84127,
9.86982,
9.89695,
9.91395,
9.93144,
9.96376,
9.99731,
10.0137,
10.0379,
10.0601,
10.0884,
10.1187,
10.1441,
10.1711,
10.2029,
10.2346,
10.2503,
10.2768,
10.2883,
10.2974,
10.3192,
10.3405,
10.3625,
10.3815,
10.3952,
10.4156,
10.4296,
10.4519,
10.4769,
10.4956,
10.5144,
10.5359,
10.562,
10.584,
10.6077,
10.6314,
10.6582,
10.6796,
10.7059,
10.7404,
10.7569,
10.7629,
10.7785,
10.8021,
10.8245,
10.8419,
10.8663,
10.8923,
10.9197,
10.9463,
10.9561,
10.9777,
10.9968,
11.0203,
11.0504,
11.0761,
11.0988,
11.1152,
11.1446,
11.1685,
11.1933,
11.2127,
11.239,
11.256,
11.2668,
11.296,
11.3185,
11.3254,
11.3577,
11.3914,
11.4118,
11.4306,
11.4575,
11.4926,
11.5154,
11.5272,
11.5607,
11.5902,
11.6197,
11.6381,
11.6696,
11.6984,
11.7211,
11.7385,
11.7679,
11.8126,
11.8584,
11.8964,
11.9467,
11.9606,
11.9978,
12.0779,
12.2261,
12.5093,
12.9322,
13.4019,
13.8968,
14.3959,
14.8956,
15.394,
15.8908,
16.3845,
16.8718,
17.3294,
17.7505,
18.0555,
18.1404,
18.1511,
18.1373,
18.1111,
18.0874,
18.0486,
18.0298,
18.011,
17.9863,
17.9523,
17.9326,
17.9086,
17.8628,
17.8503,
17.8142,
17.7718,
17.7302,
17.6966,
17.6644,
17.625,
17.5993,
17.5599,
17.5282,
17.4982,
17.4627,
17.4319,
17.4045,
17.3736,
17.3407,
17.3117,
17.2883,
17.2484,
17.2088,
17.1865,
17.1572,
17.1259,
17.0998,
17.066,
17.0375,
16.9971,
16.9586,
16.9367,
16.9024,
16.8887,
16.8656,
16.8281,
16.8138,
16.7768,
16.7419,
16.715,
16.6882,
16.6608,
16.6365,
16.6076,
16.5816,
16.5459,
16.5216,
16.4985,
16.4724,
16.4383,
16.4041,
16.3814,
16.358,
16.3264,
16.2922,
16.2649,
16.233,
16.2065,
16.1812,
16.1646,
16.132,
16.1022,
16.0724,
16.0496,
16.0127,
15.9786,
15.958,
15.9301,
15.9078,
15.8757,
15.8417,
15.8127,
15.7899,
15.7632,
15.7284,
15.7076,
15.6832,
15.6595,
15.6291,
15.6079,
15.5693,
15.5416,
15.5208,
15.4989,
15.4771,
15.4547,
15.4267,
15.3902,
15.3672,
15.3329,
15.3115,
15.2958,
15.2807,
15.2553,
15.2241,
15.1897,
15.1707,
15.1489,
15.1212,
15.1034,
15.0745,
15.0353,
15.0196,
14.9962,
14.965,
14.9402,
14.9263,
14.9183,
14.8927,
14.8658,
14.8449,
14.8115,
14.7935,
14.7775,
14.7627,
14.7306,
14.7001,
14.6865,
14.6658,
14.6408,
14.6208,
14.5934,
14.5821,
14.5524,
14.5262,
14.5063,
14.4653,
14.4339,
14.4011,
14.3795,
14.3529,
14.3215,
14.2988,
14.2691,
14.2394,
14.2082,
14.1783,
14.147,
14.1089,
14.0758,
14.0431,
14.0078,
13.9748,
13.9416,
13.9005,
13.8602,
13.8391,
13.8064,
13.7646,
13.7374,
13.6974,
13.6631,
13.6179,
13.5806,
13.572,
13.521,
13.4872,
13.4313,
13.3449,
13.2296,
13.107,
12.9023,
12.6644,
12.2862,
12.2793,
12.7405,
13.2052,
13.5138,
13.678,
14.1444,
14.6371,
15.1372,
15.6362,
16.1344,
16.6182,
17.0859,
17.438,
17.5246
  };

  std::vector<double> wy {
    0.0037966,
0.0092914,
-0.371362,
-0.412725,
-0.568017,
-0.76784,
-1.04289,
-1.38355,
-1.78738,
-2.22919,
-2.71039,
-3.19846,
-3.69545,
-4.19471,
-4.6947,
-5.19447,
-5.69448,
-6.19431,
-6.69376,
-7.19321,
-7.69297,
-8.19257,
-8.69175,
-9.19125,
-9.69097,
-10.1902,
-10.6894,
-11.1886,
-11.6883,
-12.188,
-12.687,
-13.1858,
-13.6856,
-14.185,
-14.6845,
-15.1837,
-15.6828,
-16.1821,
-16.6814,
-17.1804,
-17.6793,
-18.1791,
-18.6784,
-19.1783,
-19.6781,
-20.1777,
-20.6772,
-21.1768,
-21.6764,
-22.1762,
-22.6758,
-23.1756,
-23.6751,
-24.1744,
-24.6741,
-25.1737,
-25.6733,
-26.1726,
-26.6721,
-27.1716,
-27.671,
-28.1703,
-28.6698,
-29.1691,
-29.6679,
-30.1676,
-30.6676,
-31.1674,
-31.6668,
-32.1663,
-32.666,
-33.1654,
-33.6647,
-34.164,
-34.6632,
-35.1631,
-35.6627,
-36.1623,
-36.6618,
-37.1608,
-37.6602,
-38.1597,
-38.6594,
-39.1585,
-39.6579,
-40.1573,
-40.6569,
-41.1563,
-41.6559,
-42.1558,
-42.655,
-43.1544,
-43.6543,
-44.1534,
-44.6522,
-45.1518,
-45.6514,
-46.1507,
-46.6495,
-47.1489,
-47.6487,
-48.1477,
-48.6468,
-49.1459,
-49.6455,
-50.1445,
-50.6437,
-51.1432,
-51.6429,
-52.142,
-52.64,
-53.1379,
-53.6364,
-54.1336,
-54.6336,
-55.1322,
-55.6256,
-56.1043,
-56.5129,
-56.784,
-56.9519,
-57.0268,
-57.0564,
-57.05,
-57.0067,
-56.9532,
-56.8721,
-56.7617,
-56.5616,
-56.2861,
-55.899,
-55.4013,
-54.9029,
-54.4028,
-53.9036,
-53.4042,
-52.9057,
-52.406,
-51.9064,
-51.407,
-50.9082,
-50.4085,
-49.9094,
-49.4117,
-48.9117,
-48.413,
-47.9148,
-47.4165,
-46.9177,
-46.4188,
-45.9204,
-45.421,
-44.9226,
-44.4236,
-43.9245,
-43.4257,
-42.9267,
-42.4274,
-41.9284,
-41.4295,
-40.9303,
-40.4309,
-39.9325,
-39.4341,
-38.9345,
-38.4354,
-37.9364,
-37.4371,
-36.9383,
-36.4391,
-35.9407,
-35.4423,
-34.9428,
-34.444,
-33.944,
-33.4448,
-32.9464,
-32.4465,
-31.9478,
-31.4491,
-30.9498,
-30.4505,
-29.9513,
-29.4519,
-28.9527,
-28.4534,
-27.9547,
-27.4553,
-26.9558,
-26.4565,
-25.9577,
-25.4589,
-24.9594,
-24.4599,
-23.9609,
-23.4621,
-22.9629,
-22.4639,
-21.9646,
-21.4653,
-20.9656,
-20.4666,
-19.9675,
-19.4685,
-18.969,
-18.4703,
-17.9716,
-17.472,
-16.9728,
-16.4733,
-15.9743,
-15.4754,
-14.9763,
-14.4768,
-13.9776,
-13.4788,
-12.9792,
-12.4798,
-11.9805,
-11.4814,
-10.9819,
-10.4834,
-9.98415,
-9.48458,
-8.98506,
-8.48554,
-7.98602,
-7.48689,
-6.9883,
-6.48884,
-5.99002,
-5.49045,
-4.99071,
-4.49096,
-3.99158,
-3.49258,
-2.99379,
-2.49411,
-1.99462,
-1.4954,
-0.995653,
-0.496598,
0.00178505,
0.501637,
1.00104,
1.50008,
1.99948,
2.49926,
2.99921,
3.49855,
3.99777,
4.49726,
4.99613,
5.49584,
5.99557,
6.49532,
6.99433,
7.49335,
7.99322,
8.49273,
8.99206,
9.49158,
9.99068,
10.4905,
10.9897,
11.489,
11.9886,
12.4868,
12.9856,
13.4846,
13.984,
14.4833,
14.9823,
15.4818,
15.9809,
16.48,
16.979,
17.4781,
17.9772,
18.4757,
18.9746,
19.4735,
19.9723,
20.4712,
20.9701,
21.4684,
21.9668,
22.4663,
22.9652,
23.4635,
23.9627,
24.4611,
24.9599,
25.4578,
25.9563,
26.4566,
26.9536,
27.4524,
27.9487,
28.4417,
28.9275,
29.4139,
29.8667,
30.3118,
30.6456,
31.1349,
31.019,
30.8219,
30.4297,
29.9627,
29.7605,
29.7001,
29.6709,
29.6412,
29.6044,
29.4779,
29.2959,
28.9526,
28.4534
  };

  std::vector<double> rx, ry, ryaw, rs, rk;
  planning::Spline2D csp(wx, wy);
  for (double i = 0; i < csp.s.back(); i += 0.5) {
    auto p = csp.calc_position(i);
    rx.push_back(p.at(0));
    ry.push_back(p.at(1));
    ryaw.push_back(csp.calc_yaw(i));
    rs.push_back(i);
    rk.push_back(csp.calc_curvature(i));
  }

  auto rv = ::planning::computeSpeedProfile(rs, rk, 1.0, 0.5);
  plt::figure();
  plt::plot(rk, "*");
  plt::plot(rv, "*");
  plt::show();

  return 0;
}
